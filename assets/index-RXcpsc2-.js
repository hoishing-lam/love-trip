import{h as b,i as oe,t as m,P as _,a as w,am as te,ah as R,a9 as ne,w as z,an as ae,r as S,d as j,b as N,L as K,c as r,T as $,ao as F,g as se,a1 as H,aj as M,ap as G,p as T,f as U,k as le,o as re,ag as ce,F as ie,aq as ue,O as g,n as de,a4 as fe}from"./index-D5cxyobe.js";import{u as ve}from"./index-6A7RBb_s.js";import{p as Y}from"./dom-BxR6M3PG.js";import{c as ye,P as me}from"./on-popup-reopen-D4DfAPKx.js";import{u as E}from"./use-scope-id-DoV5j25r.js";import{H as he,I as Ie}from"./index-BgUXB2JX.js";function Oe(e){const o=oe();o&&b(o.proxy,e)}const V={show:Boolean,zIndex:w,overlay:m,duration:w,teleport:[String,Object],lockScroll:m,lazyRender:m,beforeClose:Function,overlayProps:Object,overlayStyle:Object,overlayClass:_,transitionAppear:Boolean,closeOnClickOverlay:m},De=Object.keys(V);let I=0;const L="van-overflow-hidden";function Pe(e,o){const n=ve(),c="01",s="10",l=u=>{n.move(u);const y=n.deltaY.value>0?s:c,x=ae(u.target,e.value),{scrollHeight:h,offsetHeight:P,scrollTop:C}=x;let d="11";C===0?d=P>=h?"00":"01":C+P>=h&&(d="10"),d!=="11"&&n.isVertical()&&!(parseInt(d,2)&parseInt(y,2))&&Y(u,!0)},i=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",l,{passive:!1}),I||document.body.classList.add(L),I++},a=()=>{I&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",l),I--,I||document.body.classList.remove(L))},v=()=>o()&&i(),O=()=>o()&&a();te(v),R(O),ne(O),z(o,u=>{u?i():a()})}function Z(e){const o=S(!1);return z(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const[Ce,ke]=N("overlay"),we={show:Boolean,zIndex:w,duration:w,className:_,lockScroll:m,lazyRender:m,customStyle:Object,teleport:[String,Object]};var Se=j({name:Ce,inheritAttrs:!1,props:we,setup(e,{attrs:o,slots:n}){const c=S(),s=Z(()=>e.show||!e.lazyRender),l=a=>{e.lockScroll&&Y(a,!0)},i=s(()=>{var a;const v=b(se(e.zIndex),e.customStyle);return H(e.duration)&&(v.animationDuration=`${e.duration}s`),M(r("div",T({ref:c,style:v,class:[ke(),e.className]},o),[(a=n.default)==null?void 0:a.call(n)]),[[G,e.show]])});return K("touchmove",l,{target:c}),()=>{const a=r($,{name:"van-fade",appear:!0},{default:i});return e.teleport?r(F,{to:e.teleport},{default:()=>[a]}):a}}});const be=U(Se),xe=b({},V,{round:Boolean,position:g("center"),closeIcon:g("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:g("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[pe,D]=N("popup");var ge=j({name:pe,inheritAttrs:!1,props:xe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:c}){let s,l;const i=S(),a=S(),v=Z(()=>e.show||!e.lazyRender),O=le(()=>{const t={zIndex:i.value};if(H(e.duration)){const f=e.position==="center"?"animationDuration":"transitionDuration";t[f]=`${e.duration}s`}return t}),u=()=>{s||(s=!0,i.value=e.zIndex!==void 0?+e.zIndex:ue(),o("open"))},y=()=>{s&&ye(e.beforeClose,{done(){s=!1,o("close"),o("update:show",!1)}})},x=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&y()},h=()=>{if(e.overlay){const t=b({show:e.show,class:e.overlayClass,zIndex:i.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},e.overlayProps);return r(be,T(t,E(),{onClick:x}),{default:c["overlay-content"]})}},P=t=>{o("clickCloseIcon",t),y()},C=()=>{if(e.closeable)return r(Ie,{role:"button",tabindex:0,name:e.closeIcon,class:[D("close-icon",e.closeIconPosition),he],classPrefix:e.iconPrefix,onClick:P},null)};let d;const q=()=>{d&&clearTimeout(d),d=setTimeout(()=>{o("opened")})},W=()=>o("closed"),J=t=>o("keydown",t),Q=v(()=>{var t;const{destroyOnClose:f,round:p,position:k,safeAreaInsetTop:X,safeAreaInsetBottom:ee,show:B}=e;if(!(!B&&f))return M(r("div",T({ref:a,style:O.value,role:"dialog",tabindex:0,class:[D({round:p,[k]:k}),{"van-safe-area-top":X,"van-safe-area-bottom":ee}],onKeydown:J},n,E()),[(t=c.default)==null?void 0:t.call(c),C()]),[[G,B]])}),A=()=>{const{position:t,transition:f,transitionAppear:p}=e,k=t==="center"?"van-fade":`van-popup-slide-${t}`;return r($,{name:f||k,appear:p,onAfterEnter:q,onAfterLeave:W},{default:Q})};return z(()=>e.show,t=>{t&&!s&&(u(),n.tabindex===0&&de(()=>{var f;(f=a.value)==null||f.focus()})),!t&&s&&(s=!1,o("close"))}),Oe({popupRef:a}),Pe(a,()=>e.show&&e.lockScroll),K("popstate",()=>{e.closeOnPopstate&&(y(),l=!1)}),re(()=>{e.show&&u()}),ce(()=>{l&&(o("update:show",!0),l=!1)}),R(()=>{e.show&&e.teleport&&(y(),l=!0)}),fe(me,()=>e.show),()=>e.teleport?r(F,{to:e.teleport},{default:()=>[h(),A()]}):r(ie,null,[h(),A()])}});const _e=U(ge);export{_e as P,De as a,V as p,Oe as u};
