import{d as W,t as k,m as H,a as C,b as F,r as M,I as ie,e as ge,k as w,w as L,af as me,o as U,ag as we,ah as ye,a9 as ne,L as Se,c as S,n as Y,M as N,ai as R,f as K,j as be,O as ee,i as xe,V,a1 as Pe,S as Ie,aj as ze,ak as $e,p as te}from"./index-DwhXfTyw.js";import{u as Ee}from"./index-zxW67p_d.js";import{u as oe}from"./index-fsnuqZ8q.js";import{o as Te}from"./on-popup-reopen-DkqDeXuY.js";import{i as ae,w as Le,a as ke,p as Ce}from"./dom-B3oappyM.js";import{I as _e}from"./index-DGWpMxGl.js";const[re,j]=F("swipe"),Ae={loop:k,width:C,height:C,vertical:Boolean,autoplay:H(0),duration:H(500),touchable:k,lazyRender:Boolean,initialSwipe:H(0),indicatorColor:String,showIndicators:k,stopPropagation:k},le=Symbol(re);var De=W({name:re,props:Ae,emits:["change","dragStart","dragEnd"],setup(e,{emit:b,slots:d}){const l=M(),c=M(),t=ie({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let g=!1;const v=Ee(),{children:y,linkChildren:u}=ge(le),i=w(()=>y.length),s=w(()=>t[e.vertical?"height":"width"]),f=w(()=>e.vertical?v.deltaY.value:v.deltaX.value),x=w(()=>t.rect?(e.vertical?t.rect.height:t.rect.width)-s.value*i.value:0),z=w(()=>s.value?Math.ceil(Math.abs(x.value)/s.value):i.value),$=w(()=>i.value*s.value),n=w(()=>(t.active+i.value)%i.value),I=w(()=>{const a=e.vertical?"vertical":"horizontal";return v.direction.value===a}),O=w(()=>{const a={transitionDuration:`${t.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+t.offset.toFixed(2)}px)`};if(s.value){const r=e.vertical?"height":"width",o=e.vertical?"width":"height";a[r]=`${$.value}px`,a[o]=e[o]?`${e[o]}px`:""}return a}),se=a=>{const{active:r}=t;return a?e.loop?N(r+a,-1,i.value):N(r+a,0,z.value):r},q=(a,r=0)=>{let o=a*s.value;e.loop||(o=Math.min(o,-x.value));let m=r-o;return e.loop||(m=N(m,x.value,0)),m},P=({pace:a=0,offset:r=0,emitChange:o})=>{if(i.value<=1)return;const{active:m}=t,h=se(a),D=q(h,r);if(e.loop){if(y[0]&&D!==x.value){const X=D<x.value;y[0].setOffset(X?$.value:0)}if(y[i.value-1]&&D!==0){const X=D>0;y[i.value-1].setOffset(X?-$.value:0)}}t.active=h,t.offset=D,o&&h!==m&&b("change",n.value)},B=()=>{t.swiping=!0,t.active<=-1?P({pace:i.value}):t.active>=i.value&&P({pace:-i.value})},ce=()=>{B(),v.reset(),R(()=>{t.swiping=!1,P({pace:-1,emitChange:!0})})},G=()=>{B(),v.reset(),R(()=>{t.swiping=!1,P({pace:1,emitChange:!0})})};let J;const _=()=>clearTimeout(J),A=()=>{_(),+e.autoplay>0&&i.value>1&&(J=setTimeout(()=>{G(),A()},+e.autoplay))},E=(a=+e.initialSwipe)=>{if(!l.value)return;const r=()=>{var o,m;if(!ae(l)){const h={width:l.value.offsetWidth,height:l.value.offsetHeight};t.rect=h,t.width=+((o=e.width)!=null?o:h.width),t.height=+((m=e.height)!=null?m:h.height)}i.value&&(a=Math.min(i.value-1,a),a===-1&&(a=i.value-1)),t.active=a,t.swiping=!0,t.offset=q(a),y.forEach(h=>{h.setOffset(0)}),A()};ae(l)?Y().then(r):r()},Q=()=>E(t.active);let Z;const ue=a=>{!e.touchable||a.touches.length>1||(v.start(a),g=!1,Z=Date.now(),_(),B())},ve=a=>{e.touchable&&t.swiping&&(v.move(a),I.value&&(!e.loop&&(t.active===0&&f.value>0||t.active===i.value-1&&f.value<0)||(Ce(a,e.stopPropagation),P({offset:f.value}),g||(b("dragStart",{index:n.value}),g=!0))))},p=()=>{if(!e.touchable||!t.swiping)return;const a=Date.now()-Z,r=f.value/a;if((Math.abs(r)>.25||Math.abs(f.value)>s.value/2)&&I.value){const m=e.vertical?v.offsetY.value:v.offsetX.value;let h=0;e.loop?h=m>0?f.value>0?-1:1:0:h=-Math[f.value>0?"ceil":"floor"](f.value/s.value),P({pace:h,emitChange:!0})}else f.value&&P({pace:0});g=!1,t.swiping=!1,b("dragEnd",{index:n.value}),A()},fe=(a,r={})=>{B(),v.reset(),R(()=>{let o;e.loop&&a===i.value?o=t.active===0?0:a:o=a%i.value,r.immediate?R(()=>{t.swiping=!1}):t.swiping=!1,P({pace:o-t.active,emitChange:!0})})},de=(a,r)=>{const o=r===n.value,m=o?{backgroundColor:e.indicatorColor}:void 0;return S("i",{style:m,class:j("indicator",{active:o})},null)},he=()=>{if(d.indicator)return d.indicator({active:n.value,total:i.value});if(e.showIndicators&&i.value>1)return S("div",{class:j("indicators",{vertical:e.vertical})},[Array(i.value).fill("").map(de)])};return oe({prev:ce,next:G,state:t,resize:Q,swipeTo:fe}),u({size:s,props:e,count:i,activeIndicator:n}),L(()=>e.initialSwipe,a=>E(+a)),L(i,()=>E(t.active)),L(()=>e.autoplay,A),L([Le,ke,()=>e.width,()=>e.height],Q),L(me(),a=>{a==="visible"?A():_()}),U(E),we(()=>E(t.active)),Te(()=>E(t.active)),ye(_),ne(_),Se("touchmove",ve,{target:c}),()=>{var a;return S("div",{ref:l,class:j()},[S("div",{ref:c,style:O.value,class:j("track",{vertical:e.vertical}),onTouchstartPassive:ue,onTouchend:p,onTouchcancel:p},[(a=d.default)==null?void 0:a.call(d)]),he()])}}});const Ue=K(De),[Me,Oe]=F("swipe-item");var Be=W({name:Me,setup(e,{slots:b}){let d;const l=ie({offset:0,inited:!1,mounted:!1}),{parent:c,index:t}=be(le);if(!c)return;const g=w(()=>{const u={},{vertical:i}=c.props;return c.size.value&&(u[i?"height":"width"]=`${c.size.value}px`),l.offset&&(u.transform=`translate${i?"Y":"X"}(${l.offset}px)`),u}),v=w(()=>{const{loop:u,lazyRender:i}=c.props;if(!i||d)return!0;if(!l.mounted)return!1;const s=c.activeIndicator.value,f=c.count.value-1,x=s===0&&u?f:s-1,z=s===f&&u?0:s+1;return d=t.value===s||t.value===x||t.value===z,d}),y=u=>{l.offset=u};return U(()=>{Y(()=>{l.mounted=!0})}),oe({setOffset:y}),()=>{var u;return S("div",{class:Oe(),style:g.value},[v.value?(u=b.default)==null?void 0:u.call(b):null])}}});const Ke=K(Be),[Re,T]=F("image"),je={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:C,height:C,radius:C,lazyLoad:Boolean,iconSize:C,showError:k,errorIcon:ee("photo-fail"),iconPrefix:String,showLoading:k,loadingIcon:ee("photo"),crossorigin:String,referrerpolicy:String,decoding:String};var Ye=W({name:Re,props:je,emits:["load","error"],setup(e,{emit:b,slots:d}){const l=M(!1),c=M(!0),t=M(),{$Lazyload:g}=xe().proxy,v=w(()=>{const n={width:V(e.width),height:V(e.height)};return Pe(e.radius)&&(n.overflow="hidden",n.borderRadius=V(e.radius)),n});L(()=>e.src,()=>{l.value=!1,c.value=!0});const y=n=>{c.value&&(c.value=!1,b("load",n))},u=()=>{const n=new Event("load");Object.defineProperty(n,"target",{value:t.value,enumerable:!0}),y(n)},i=n=>{l.value=!0,c.value=!1,b("error",n)},s=(n,I,O)=>O?O():S(_e,{name:n,size:e.iconSize,class:I,classPrefix:e.iconPrefix},null),f=()=>{if(c.value&&e.showLoading)return S("div",{class:T("loading")},[s(e.loadingIcon,T("loading-icon"),d.loading)]);if(l.value&&e.showError)return S("div",{class:T("error")},[s(e.errorIcon,T("error-icon"),d.error)])},x=()=>{if(l.value||!e.src)return;const n={alt:e.alt,class:T("img"),decoding:e.decoding,style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?ze(S("img",te({ref:t},n),null),[[$e("lazy"),e.src]]):S("img",te({ref:t,src:e.src,onLoad:y,onError:i},n),null)},z=({el:n})=>{const I=()=>{n===t.value&&c.value&&u()};t.value?I():Y(I)},$=({el:n})=>{n===t.value&&!l.value&&i()};return g&&Ie&&(g.$on("loaded",z),g.$on("error",$),ne(()=>{g.$off("loaded",z),g.$off("error",$)})),U(()=>{Y(()=>{var n;(n=t.value)!=null&&n.complete&&!e.lazyLoad&&u()})}),()=>{var n;return S("div",{class:T({round:e.round,block:e.block}),style:v.value},[x(),f(),(n=d.default)==null?void 0:n.call(d)])}}});const qe=K(Ye);export{qe as I,Ke as S,Ue as a};
